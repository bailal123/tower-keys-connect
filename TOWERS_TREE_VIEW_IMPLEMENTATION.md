# ุชูููุฐ ุนุฑุถ ุดุฌุฑุฉ ุงูุฃุจุฑุงุฌ (Tree View Implementation)

## ุงูุชุบููุฑุงุช ุงููุทุจูุฉ

### 1. ุฅูุดุงุก ุตูุญุฉ ุฌุฏูุฏุฉ: TowersTreePage.tsx

ุชู ุฅูุดุงุก ุตูุญุฉ ุฌุฏูุฏุฉ ูุนุฑุถ ุงูุฃุจุฑุงุฌ ุจุดูู ูุฑูู ูุงุจู ููุชูุณูุน ุจุฏูุงู ูู ุงูุนุฑุถ ุงููุณุทุญ ุงูุณุงุจู.

#### ุงูููุฒุงุช ุงูุฑุฆูุณูุฉ:

**ุฃ. ูููููุฉ ุดุฌุฑูุฉ ูุงุจูุฉ ููุชูุณูุน:**
- **ุงูุจุฑุฌ (Tower)** โ **ุงูุจูููุงุช (Blocks)** โ **ุงูุทูุงุจู (Floors)** โ **ุงูุดูู (Units)**
- ูู ูุณุชูู ูุงุจู ููุถุบุท ููุชูุณูุน/ุงูุทู
- ุฃููููุฉ `ChevronRight` ููุนูุงุตุฑ ุงููุทููุฉ ู `ChevronDown` ููุนูุงุตุฑ ุงูููุณุนุฉ

**ุจ. ุงูุชุญููู ุงูุชุฏุฑูุฌู (Lazy Loading):**
- ูุง ูุชู ุชุญููู ุงูุจูุงูุงุช ุงููุฑุนูุฉ ุฅูุง ุนูุฏ ุงูุถุบุท ุนูู ุงูุนูุตุฑ ุงูุฃุจ
- ูุชู ุญูุธ ุงูุจูุงูุงุช ุงููุญููุฉ ูู ุงูู state ูุชุฌูุจ ุฅุนุงุฏุฉ ุงูุชุญููู
- ูุคุดุฑุงุช ุชุญููู (`Loader2`) ุฃุซูุงุก ุฌูุจ ุงูุจูุงูุงุช

**ุฌ. ุฅุฏุงุฑุฉ ุงูุญุงูุฉ (State Management):**
```typescript
// ุชุชุจุน ุงูุนูุงุตุฑ ุงูููุณุนุฉ
const [expandedTowers, setExpandedTowers] = useState<Set<number>>(new Set());
const [expandedBlocks, setExpandedBlocks] = useState<Set<number>>(new Set());
const [expandedFloors, setExpandedFloors] = useState<Set<number>>(new Set());

// ุญูุธ ุงูุจูุงูุงุช ุงููุญููุฉ
const [towerBlocks, setTowerBlocks] = useState<Record<number, TowerBlock[]>>({});
const [blockFloors, setBlockFloors] = useState<Record<number, BlockFloor[]>>({});
const [floorUnits, setFloorUnits] = useState<Record<number, Unit[]>>({});

// ุชุชุจุน ุญุงูุฉ ุงูุชุญููู
const [loadingBlocks, setLoadingBlocks] = useState<Set<number>>(new Set());
const [loadingFloors, setLoadingFloors] = useState<Set<number>>(new Set());
const [loadingUnits, setLoadingUnits] = useState<Set<number>>(new Set());
```

**ุฏ. ูุงุฌูุงุช API ุงููุณุชุฎุฏูุฉ:**
```typescript
// ุชุญููู ุงูุจูููุงุช ุนูุฏ ุชูุณูุน ุงูุจุฑุฌ
towerBlockAPI.getAll({ towerId, onlyActive: true }, language)

// ุชุญููู ุงูุทูุงุจู ุนูุฏ ุชูุณูุน ุงูุจููู
blockFloorAPI.getAll({ towerBlockId: blockId, onlyActive: true }, language)

// ุชุญููู ุงูุดูู ุนูุฏ ุชูุณูุน ุงูุทุงุจู
unitAPI.getAllAdvanced({ blockFloorId: floorId, onlyActive: true }, language)
```

**ูู. ุงูุชุตููู ุงููุฑุฆู:**
- **ุงูุจุฑุฌ**: ุฎูููุฉ ุจูุถุงุกุ ุฃููููุฉ `Building2` ุฒุฑูุงุก
- **ุงูุจููู**: ุฎูููุฉ ุฒุฑูุงุก ูุงุชุญุฉ (`bg-blue-50`)ุ ุฃููููุฉ `Box`
- **ุงูุทุงุจู**: ุฎูููุฉ ุฎุถุฑุงุก ูุงุชุญุฉ (`bg-green-50`)ุ ุฃููููุฉ `Layers`
- **ุงูุดูุฉ**: ุฎูููุฉ ุฃุฑุฌูุงููุฉ ูุงุชุญุฉ (`bg-purple-50`)ุ ุฃููููุฉ `Home`
- ุฅุฒุงุญุฉ ุชุฏุฑูุฌูุฉ ุจู `ml-8` ููู ูุณุชูู ูุฑุนู

**ู. ุฒุฑ ุงูุชุนุฏูู (Edit Button):**
- ุฒุฑ ุชุนุฏูู ุนูู ูู ุจุทุงูุฉ
- ุงูุชููู ุฅูู ุงูุตูุญุงุช ุงูููุงุณุจุฉ:
  - ุงูุจุฑุฌ/ุงูุจููู: `/building-builder/${towerId}`
  - ุงูุทุงุจู: `/building-builder`
  - ุงูุดูุฉ: `/residential-units`

**ุฒ. ุงูุฏุนู ุซูุงุฆู ุงููุบุฉ:**
- ุฌููุน ุงููุตูุต ูุนุฑุจุฉ ุจุงููุงูู (ุนุฑุจู/ุฅูุฌููุฒู)
- ุงุณุชุฎุฏุงู `useLanguage` hook ููุชุจุฏูู ุงูุชููุงุฆู

### 2. ุฅุตูุงุญ ูุดููุฉ ุงุณุชุฏุนุงุกุงุช API ุงููุชูุฑุฑุฉ

**ุงููุดููุฉ ุงูุณุงุจูุฉ:**
- ูุงูุช ุงูุฏูู ูุงููุฏู ูุงูููุงุทู ุชูุญููู ูู ูู render
- ุงุณุชุฏุนุงุกุงุช API ูุชุนุฏุฏุฉ ุบูุฑ ุถุฑูุฑูุฉ

**ุงูุญู:**
- ุงุณุชุฎุฏุงู `useEffect` ูุน dependencies ูุญุฏุฏุฉ ุจุนูุงูุฉ
- ุชุญููู ุงูุฏูู ูุฑุฉ ูุงุญุฏุฉ ุนูุฏ ุชุญููู ุงูุตูุญุฉ
- ุชุญููู ุงููุฏู ููุท ุนูุฏ ุชุบููุฑ ุงูุฏููุฉ ุงููุฎุชุงุฑุฉ
- ุชุญููู ุงูููุงุทู ููุท ุนูุฏ ุชุบููุฑ ุงููุฏููุฉ ุงููุฎุชุงุฑุฉ

```typescript
// ุชุญููู ุงูุฏูู ูุฑุฉ ูุงุญุฏุฉ
useEffect(() => {
  countryAPI.getAll(true, language).then(...)
}, [language, t, showError]);

// ุชุญููู ุงููุฏู ุนูุฏ ุงุฎุชูุงุฑ ุฏููุฉ
useEffect(() => {
  if (!filters.countryId) { 
    setCities([]); 
    return;
  }
  cityAPI.getAll(true, Number(filters.countryId), language).then(...)
}, [filters.countryId, language, t, showError]);

// ุชุญููู ุงูููุงุทู ุนูุฏ ุงุฎุชูุงุฑ ูุฏููุฉ
useEffect(() => {
  if (!filters.cityId) { 
    setAreas([]); 
    return;
  }
  areaAPI.getAll(true, Number(filters.cityId), language).then(...)
}, [filters.cityId, language, t, showError]);
```

### 3. ุชุญุฏูุซ AppRouter

ุชู ุชุญุฏูุซ ุงูู routing ูุงุณุชุฎุฏุงู ุงูุตูุญุฉ ุงูุฌุฏูุฏุฉ:

```typescript
import TowersTreePage from '../../pages/TowersTreePage';

<Route
  path="/towers"
  element={
    <ProtectedRoute>
      <ProtectedLayout>
        <TowersTreePage />
      </ProtectedLayout>
    </ProtectedRoute>
  }
/>
```

## ููููุฉ ุงูุงุณุชุฎุฏุงู

### ุนุฑุถ ุงูุฃุจุฑุงุฌ:
1. ุงูุชูู ุฅูู ุตูุญุฉ ุงูุฃุจุฑุงุฌ ูู ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ
2. ุงุณุชุฎุฏู ุงูููุงุชุฑ ููุจุญุซ ุญุณุจ ุงูุฏููุฉ/ุงููุฏููุฉ/ุงูููุทูุฉ/ุงูุญุงูุฉ/ุงููุฑุญูุฉ
3. ุงุถุบุท ุนูู ุฃููููุฉ ุงูุณูู ุจุฌุงูุจ ุงูุจุฑุฌ ูุชูุณูุนู ูุนุฑุถ ุงูุจูููุงุช

### ุนุฑุถ ุงูุจูููุงุช:
1. ุจุนุฏ ุชูุณูุน ุงูุจุฑุฌุ ุณุชุธูุฑ ูุงุฆูุฉ ุงูุจูููุงุช
2. ุงุถุบุท ุนูู ุฃููููุฉ ุงูุณูู ุจุฌุงูุจ ุงูุจููู ูุชูุณูุนู ูุนุฑุถ ุงูุทูุงุจู

### ุนุฑุถ ุงูุทูุงุจู:
1. ุจุนุฏ ุชูุณูุน ุงูุจูููุ ุณุชุธูุฑ ูุงุฆูุฉ ุงูุทูุงุจู
2. ุงุถุบุท ุนูู ุฃููููุฉ ุงูุณูู ุจุฌุงูุจ ุงูุทุงุจู ูุชูุณูุนู ูุนุฑุถ ุงูุดูู

### ุงูุชุนุฏูู:
- ุงุถุบุท ุนูู ุฒุฑ "ุชุนุฏูู" (`Edit`) ุนูู ุฃู ุจุทุงูุฉ ููุงูุชูุงู ุฅูู ุตูุญุฉ ุงูุชุนุฏูู ุงูููุงุณุจุฉ

## ุงูููุงุฆุฏ

### 1. ุชุฌุฑุจุฉ ูุณุชุฎุฏู ุฃูุถู:
- ุนุฑุถ ูุฑูู ุณูู ุงูููู ูุงูุชููู
- ุชุญููู ุชุฏุฑูุฌู ูุชุญุณูู ุงูุฃุฏุงุก
- ูุคุดุฑุงุช ุจุตุฑูุฉ ูุงุถุญุฉ ููุญุงูุฉ

### 2. ุฃุฏุงุก ูุญุณูู:
- ุชุญููู ุงูุจูุงูุงุช ุนูุฏ ุงูุญุงุฌุฉ ููุท (on-demand)
- ุชุฎุฒูู ูุคูุช ููุจูุงูุงุช ุงููุญููุฉ
- ุชูููู ุงุณุชุฏุนุงุกุงุช API ุบูุฑ ุงูุถุฑูุฑูุฉ

### 3. ูุงุจููุฉ ุงูุตูุงูุฉ:
- ููุฏ ููุธู ููุงุถุญ
- ูุตู ูุงุถุญ ุจูู ุงููุณุชููุงุช
- ุณูููุฉ ุฅุถุงูุฉ ูุณุชููุงุช ุฌุฏูุฏุฉ ูุณุชูุจูุงู

### 4. ูุงุฌูุฉ ุจุฏูููุฉ:
- ุฃููุงู ูููุฒุฉ ููู ูุณุชูู
- ุฃููููุงุช ุชูุถูุญูุฉ
- ุฏุนู ูุงูู ููุบุชูู ุงูุนุฑุจูุฉ ูุงูุฅูุฌููุฒูุฉ

## ุงููููุงุช ุงููุชุฃุซุฑุฉ

1. **ุชู ุฅูุดุงุคู:**
   - `src/pages/TowersTreePage.tsx` (ุตูุญุฉ ุฌุฏูุฏุฉ ูููุงู)

2. **ุชู ุชุนุฏููู:**
   - `src/components/layout/AppRouter.tsx` (ุชุญุฏูุซ ุงูู import ูุงูู route)

3. **ูู ููุญุฐู:**
   - `src/pages/TowersPage.tsx` (ูุญููุธ ููุณุฎุฉ ุงุญุชูุงุทูุฉ)

## ููุงุญุธุงุช ูููุฉ

### ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก (Error Handling):
```typescript
try {
  const resp = await towerBlockAPI.getAll({ towerId, onlyActive: true }, language);
  const blocks = resp.data?.data || resp.data || [];
  setTowerBlocks(prev => ({ ...prev, [towerId]: blocks }));
} catch (err: unknown) {
  const error = err as { response?: { data?: { message?: string } } };
  showError(error?.response?.data?.message || t('error'), '');
} finally {
  setLoadingBlocks(prev => {
    const newSet = new Set(prev);
    newSet.delete(towerId);
    return newSet;
  });
}
```

### TypeScript Types:
ุฌููุน ุงูู types ูุนุฑููุฉ ุจุดูู ุตุญูุญ:
- `TowerRow`
- `TowerBlock`
- `BlockFloor`
- `Unit`
- `NamedLookup`

### Linting:
- ูุง ุชูุฌุฏ ุฃุฎุทุงุก eslint
- ูุง ุชูุฌุฏ ุชุญุฐูุฑุงุช TypeScript
- Build ูุงุฌุญ ุจุฏูู ุฃุฎุทุงุก

## ุงูุชุทููุฑุงุช ุงููุณุชูุจููุฉ ุงูููุชุฑุญุฉ

1. **ุงูุจุญุซ ุงููุชูุฏู:**
   - ุงูุจุญุซ ุฏุงุฎู ุงูุจูููุงุช ูุงูุทูุงุจู ูุงูุดูู
   - ุชูููุฒ ุงููุชุงุฆุฌ ูู ุงูุดุฌุฑุฉ

2. **ุงูุนูููุงุช ุงููุฌูุนุฉ:**
   - ุชุญุฏูุฏ ูุชุนุฏุฏ
   - ุนูููุงุช ุฌูุงุนูุฉ (ุชูุนูู/ุชุนุทูู/ุญุฐู)

3. **ุงููุฑุฒ ูุงูุชุฑุชูุจ:**
   - ูุฑุฒ ุญุณุจ ุงูุงุณู/ุงูุฑูู/ุงูุชุงุฑูุฎ
   - ุชุฑุชูุจ ูุฎุตุต

4. **ุงูุฅุญุตุงุฆูุงุช:**
   - ุนุฏุฏ ุงูุจูููุงุช/ุงูุทูุงุจู/ุงูุดูู ููู ุจุฑุฌ
   - ูุณุจุฉ ุงูุฅุดุบุงู
   - ุงูุญุงูุงุช ุงููุฎุชููุฉ

5. **ุงูุณุญุจ ูุงูุฅููุงุช:**
   - ุฅุนุงุฏุฉ ุชุฑุชูุจ ุงูุนูุงุตุฑ
   - ููู ุงูุดูู ุจูู ุงูุทูุงุจู

6. **ุงูุชุตุฏูุฑ ูุงูุทุจุงุนุฉ:**
   - ุชุตุฏูุฑ ุงููููู ูู PDF/Excel
   - ุทุจุงุนุฉ ุงูุดุฌุฑุฉ ุงููุงููุฉ

## ุงูุงุฎุชุจุงุฑุงุช ุงููุทููุจุฉ

- [x] ุชุญููู ุงูุฃุจุฑุงุฌ ุจูุฌุงุญ
- [x] ุงูููุงุชุฑ ุชุนูู ุจุดูู ุตุญูุญ
- [x] ุชูุณูุน ุงูุจุฑุฌ ูุญูู ุงูุจูููุงุช
- [x] ุชูุณูุน ุงูุจููู ูุญูู ุงูุทูุงุจู
- [x] ุชูุณูุน ุงูุทุงุจู ูุญูู ุงูุดูู
- [x] ุฒุฑ ุงูุชุนุฏูู ูููู ุฅูู ุงูุตูุญุฉ ุงูุตุญูุญุฉ
- [x] ุงูุทู ูุงูุชูุณูุน ูุนููุงู ุจุดูู ุตุญูุญ
- [x] ูุคุดุฑุงุช ุงูุชุญููู ุชุธูุฑ ุจุดูู ุตุญูุญ
- [x] ุงูุฏุนู ุซูุงุฆู ุงููุบุฉ ูุนูู
- [x] ูุง ุชูุฌุฏ ุงุณุชุฏุนุงุกุงุช API ููุฑุฑุฉ
- [x] Build ูุงุฌุญ ุจุฏูู ุฃุฎุทุงุก

## ุงูุฎูุงุตุฉ

ุชู ุจูุฌุงุญ ุชุญููู ุตูุญุฉ ุงูุฃุจุฑุงุฌ ูู ุนุฑุถ ูุณุทุญ ุชูููุฏู ุฅูู ุนุฑุถ ุดุฌุฑู ุชูุงุนูู ูููุฑ:
- ุชุฌุฑุจุฉ ูุณุชุฎุฏู ูุญุณููุฉ
- ุฃุฏุงุก ุฃูุถู
- ุชููู ุฃุณูู ุจูู ุงููุณุชููุงุช ุงููุฑููุฉ
- ุฅุฏุงุฑุฉ ูุนูุงูุฉ ููุจูุงูุงุช ุงููุจูุฑุฉ

ุงููุดุฑูุน ุฌุงูุฒ ููุงุณุชุฎุฏุงู ูุงูุงุฎุชุจุงุฑ! ๐
