# ุชุญุฏูุซ ุชุฎุฒูู ุฑูู ุงููุญุฏุฉ (unitNumber) - ุชุฎุฒูู ุงูุฑูู ููุท ุจุฏูู ุฑูุฒ ุงูุทุงุจู ุฃู ุงูุจุฑุฌ
**ุงูุชุงุฑูุฎ**: 5 ุฃูุชูุจุฑ 2025

## ๐ ุงููุตู
ุชู ุชุญุฏูุซ ูุธุงู ุชุฎุฒูู `unitNumber` ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุจุญูุซ ูุชู ุชุฎุฒูู **ุฑูู ุงููุญุฏุฉ ููุท** ูุฌููุน ุฃููุงุน ุงููุญุฏุงุช (ุณูููุฉุ ุชุฌุงุฑูุฉุ ููุงุชุจุ ููุงููุ ุฅูุฎ)ุ ุจุฏูู ุฅุถุงูุฉ ุฑูุฒ ุงูุทุงุจู ุฃู ุงุณู ุงูุจุฑุฌ. ุณูุชู ุฏูุฌ ูุฐู ุงููุนูููุงุช ูู ุงููุฑููุช ุฅูุฏ ุนูุฏ ุงูุนุฑุถ.

## ๐ฏ ุงููุดููุฉ ุงูุณุงุจูุฉ

### ุงูุชุฎุฒูู ุงููุฏูู:
```typescript
// ูููุญุฏุงุช ุงูุณูููุฉ
unitNumber: "01"  // ุฑูู ููุท โ

// ูููุญุฏุงุช ุบูุฑ ุงูุณูููุฉ
unitNumber: "Tower-F5-01"  // ููุฏ ูุงูู ูุน ุงุณู ุงูุจุฑุฌ ูุฑูุฒ ุงูุทุงุจู โ
```

### ุงููุดุงูู:
1. **ุนุฏู ุงูุงุชุณุงู**: ุงููุญุฏุงุช ุงูุณูููุฉ ุชูุฎุฒู ุจุฑูู ููุทุ ูุบูุฑ ุงูุณูููุฉ ุชูุฎุฒู ุจููุฏ ูุงูู
2. **ุตุนูุจุฉ ุงูุชุนุฏูู**: ุฅุฐุง ุชุบูุฑ ุงุณู ุงูุจุฑุฌ ุฃู ุฑูุฒ ุงูุทุงุจูุ ุชุญุชุงุฌ ูุชุญุฏูุซ ุฌููุน ุงููุญุฏุงุช
3. **ุชูุฑุงุฑ ุงูุจูุงูุงุช**: ูุนูููุงุช ุงูุจุฑุฌ ูุงูุทุงุจู ููุฌูุฏุฉ ุจุงููุนู ูู `TowerId`, `BlockId`, `floorCode`
4. **ูุฑููุฉ ุฃูู**: ูุง ูููู ุชุบููุฑ ุตูุบุฉ ุงูุนุฑุถ ุจุฏูู ุชุนุฏูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

## โ ุงูุญู ุงููุทุจู

### ุงูุชุฎุฒูู ุงูุฌุฏูุฏ (ููุญุฏ ูุฌููุน ุงูุฃููุงุน):
```typescript
// ุฌููุน ุงููุญุฏุงุช - ุณูููุฉ ูุบูุฑ ุณูููุฉ
unitNumber: "01"  // ุฑูู ุงููุญุฏุฉ ููุท โ
unitNumber: "02"  // ุฑูู ุงููุญุฏุฉ ููุท โ
unitNumber: "STORE-01"  // ูููุญุฏุงุช ุงููุฏููุฉ (ุฎุฏูู/ูุฎุชูุท/ุฃุฑุถู) โ
```

### ุงูุจูุงูุงุช ุงููุงููุฉ ุงููุฎุฒูุฉ:
```typescript
{
  unitNumber: "01",           // ุฑูู ุงููุญุฏุฉ ููุท
  floorCode: "F5",           // ุฑูุฒ ุงูุทุงุจู
  TowerId: 123,              // ูุนุฑู ุงูุจุฑุฌ
  BlockId: 456,              // ูุนุฑู ุงูุจููู
  blockFloorId: 789,         // ูุนุฑู ุทุงุจู ุงูุจููู
  type: UnitType.Office,     // ููุน ุงููุญุฏุฉ
  // ... ุจุงูู ุงูุจูุงูุงุช
}
```

## ๐ ุงูุชุบููุฑุงุช ูู ุงูููุฏ

### ูุจู ุงูุชุนุฏูู:
```typescript
else if(d.unitsDefinition && d.unitsDefinition.count>0){ 
  const t=unitTypeNumeric(d.unitsDefinition.type)
  const isRes=t===UnitType.Residential
  for(let i=0;i<d.unitsDefinition.count;i++){ 
    const uNum=d.unitsDefinition.startNumber+i
    const code=buildUnitCode(d.floorCode,uNum,d.unitsDefinition)
    units.push({ 
      unitNumber:isRes?String(uNum).padStart(2,'0'):code,  // โ ููุฏ ูุฎุชูู ุญุณุจ ุงูููุน
      // ... ุจุงูู ุงูุจูุงูุงุช
    }) 
  } 
}
```

### ุจุนุฏ ุงูุชุนุฏูู:
```typescript
else if(d.unitsDefinition && d.unitsDefinition.count>0){ 
  const t=unitTypeNumeric(d.unitsDefinition.type)
  for(let i=0;i<d.unitsDefinition.count;i++){ 
    const uNum=d.unitsDefinition.startNumber+i
    // ุชุฎุฒูู ุฑูู ุงููุญุฏุฉ ููุท ูุฌููุน ุงูุฃููุงุน (ุจุฏูู ุฑูุฒ ุงูุทุงุจู ุฃู ุงูุจุฑุฌ)
    units.push({ 
      unitNumber:String(uNum).padStart(2,'0'),  // โ ุฑูู ููุท ูุฌููุน ุงูุฃููุงุน
      // ... ุจุงูู ุงูุจูุงูุงุช
    }) 
  } 
}
```

### ุฅุฒุงูุฉ ุงูุฏุงูุฉ ุบูุฑ ุงููุณุชุฎุฏูุฉ:
ุชู ุญุฐู ุฏุงูุฉ `buildUnitCode` ูุฃููุง ูู ุชุนุฏ ุถุฑูุฑูุฉ ูู ุนูููุฉ ุงูุญูุธ. ูููู ุจูุงุก ุงูููุฏ ุงููุงูู ูู ุงููุฑููุช ุฅูุฏ ุนูุฏ ุงูุนุฑุถ.

## ๐ ุฃูุซูุฉ ุงูุชุฎุฒูู

### ูุซุงู 1: ูุญุฏุงุช ุณูููุฉ (Regular)
```typescript
// ุงูุฅุนุฏุงุฏุงุช:
floorType: Regular
codePrefix: "F"
startNumber: 1
unitsCount: 4
floorNumber: 5

// ุงูุชุฎุฒูู ูู DB:
{unitNumber: "01", floorCode: "F5", type: Residential}
{unitNumber: "02", floorCode: "F5", type: Residential}
{unitNumber: "03", floorCode: "F5", type: Residential}
{unitNumber: "04", floorCode: "F5", type: Residential}
```

### ูุซุงู 2: ูุญุฏุงุช ููุชุจูุฉ (Office)
```typescript
// ุงูุฅุนุฏุงุฏุงุช:
floorType: Office
codePrefix: "O"
startNumber: 10
unitsCount: 3
floorNumber: 2

// ุงูุชุฎุฒูู ูู DB:
{unitNumber: "10", floorCode: "O2", type: Office}
{unitNumber: "11", floorCode: "O2", type: Office}
{unitNumber: "12", floorCode: "O2", type: Office}
```

### ูุซุงู 3: ููุงูู ุณูุงุฑุงุช (Parking)
```typescript
// ุงูุฅุนุฏุงุฏุงุช:
floorType: Parking
codePrefix: "P"
codePrefixStartNumber: 4
startNumber: 1
unitsCount: 20
floorNumber: -1

// ุงูุชุฎุฒูู ูู DB:
{unitNumber: "01", floorCode: "P4", type: Parking}
{unitNumber: "02", floorCode: "P4", type: Parking}
{unitNumber: "03", floorCode: "P4", type: Parking}
// ... ุญุชู 20
```

### ูุซุงู 4: ุทุงุจู ุฎุฏูู (Service) - ุฅุฏุฎุงู ูุฏูู
```typescript
// ุงูุฅุนุฏุงุฏุงุช:
floorType: Service
mixed units:
  - type: Storage, code: "STORE-01"
  - type: Clinic, code: "CLINIC-A"
  - type: Restaurant, code: "REST-001"

// ุงูุชุฎุฒูู ูู DB:
{unitNumber: "STORE-01", floorCode: "S5", type: Storage}
{unitNumber: "CLINIC-A", floorCode: "S5", type: Clinic}
{unitNumber: "REST-001", floorCode: "S5", type: Restaurant}
```

## ๐จ ุงูุนุฑุถ ูู ุงููุฑููุช ุฅูุฏ

ุนูุฏ ุนุฑุถ ุงููุญุฏุงุช ูู ุงููุฑููุช ุฅูุฏุ ูููู ุฏูุฌ ุงููุนูููุงุช ุญุณุจ ุงูุญุงุฌุฉ:

### ุทุฑููุฉ ุจูุงุก ุงูููุฏ ุงููุงูู ููุนุฑุถ:
```typescript
// ุฏุงูุฉ ูุณุงุนุฏุฉ ูู ุงููุฑููุช ุฅูุฏ
function buildFullUnitCode(unit: Unit, floor: Floor, tower: Tower, includeOptions?: {
  includeTowerName?: boolean,
  includeBlockName?: boolean,
  includeFloorCode?: boolean
}): string {
  const parts: string[] = []
  
  if (includeOptions?.includeTowerName && tower.name) {
    parts.push(tower.name)
  }
  
  if (includeOptions?.includeBlockName && unit.blockName) {
    parts.push(unit.blockName)
  }
  
  if (includeOptions?.includeFloorCode && floor.floorCode) {
    parts.push(floor.floorCode)
  }
  
  parts.push(unit.unitNumber)
  
  return parts.join('-')
}

// ุฃูุซูุฉ ุงูุงุณุชุฎุฏุงู:
buildFullUnitCode(unit, floor, tower, {
  includeTowerName: true,
  includeFloorCode: true
})
// ุงููุชูุฌุฉ: "Tower-A-F5-01"

buildFullUnitCode(unit, floor, tower, {
  includeFloorCode: true
})
// ุงููุชูุฌุฉ: "F5-01"

buildFullUnitCode(unit, floor, tower, {})
// ุงููุชูุฌุฉ: "01"
```

### ุฃูุซูุฉ ุงูุนุฑุถ:

#### ุนุฑุถ ูุจุณุท:
```
ุงููุญุฏุฉ: 01
ุงูุทุงุจู: F5
ุงูุจุฑุฌ: Tower A
```

#### ุนุฑุถ ุจููุฏ ูุงูู:
```
ุงูููุฏ ุงููุงูู: Tower-A-F5-01
```

#### ุนุฑุถ ูู ุฌุฏูู:
| ุงููุญุฏุฉ | ุงูุทุงุจู | ุงูุจููู | ุงูุจุฑุฌ | ุงูููุน | ุงูุญุงูุฉ |
|--------|--------|--------|-------|-------|--------|
| 01 | F5 | A | Tower A | ููุชุจ | ูุชุงุญ |
| 02 | F5 | A | Tower A | ููุชุจ | ูุญุฌูุฒ |

## ๐ก ุงูููุงุฆุฏ

### 1. ุงุชุณุงู ุงูุจูุงูุงุช
- **ููุญุฏ**: ุฌููุน ุงููุญุฏุงุช ุชูุฎุฒู ุจููุณ ุงูุทุฑููุฉ
- **ููุทูู**: ุงูุฑูู ูู ุญูู ุงูุฑููุ ูุงููุนูููุงุช ุงูุฅุถุงููุฉ ูู ุญููููุง ุงูุฎุงุตุฉ

### 2. ุณูููุฉ ุงูุตูุงูุฉ
- **ุชุญุฏูุซ ุณูู**: ุชุบููุฑ ุงุณู ุงูุจุฑุฌ ุฃู ุฑูุฒ ุงูุทุงุจู ูุง ูุคุซุฑ ุนูู ุฃุฑูุงู ุงููุญุฏุงุช
- **ุนุฏู ุงูุชูุฑุงุฑ**: ูู ูุนูููุฉ ูุฎุฒูุฉ ูุฑุฉ ูุงุญุฏุฉ ููุท

### 3. ูุฑููุฉ ูู ุงูุนุฑุถ
- **ุชุฎุตูุต**: ูููู ุนุฑุถ ุงูููุฏ ุจุตูุบ ูุฎุชููุฉ ุญุณุจ ุงูุณูุงู
- **ูุบุงุช ูุชุนุฏุฏุฉ**: ุณูููุฉ ุฏุนู ุนุฑุถ ูุชุนุฏุฏ ุงููุบุงุช

### 4. ุงุณุชุนูุงูุงุช ุฃุณุฑุน
- **ููุฑุณุฉ**: `unitNumber` ุจุณูุท ูููู ููุฑุณุชู ุจููุงุกุฉ
- **ุจุญุซ**: ุงูุจุญุซ ุจุฑูู ุงููุญุฏุฉ ุฃุณุฑุน ูุฃุจุณุท

### 5. ุญุฌู ุฃูู
- **ุชูููุฑ ูุณุงุญุฉ**: ุชุฎุฒูู "01" ุจุฏูุงู ูู "Tower-A-Block-B-F5-01"
- **ููู ุฃุณุฑุน**: ุจูุงูุงุช ุฃูู ููููู ุจูู ุงูุฎุงุฏู ูุงูุนููู

## ๐ ุงูุชุฑุญูู (Migration)

ุฅุฐุง ูุงูุช ููุงู ุจูุงูุงุช ูุฏููุฉ ุจุตูุบุฉ ุงูููุฏ ุงููุงููุ ูููู ุฅูุดุงุก ุณูุฑูุจุช ุชุฑุญูู:

```sql
-- ูุซุงู SQL ููุชุฑุญูู (ุชุนุชูุฏ ุนูู ุจููุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช)
UPDATE Units
SET unitNumber = 
  CASE 
    WHEN unitNumber LIKE '%-%-%-%' THEN 
      SUBSTRING(unitNumber FROM POSITION('-' IN REVERSE(unitNumber)) + 1)
    ELSE 
      unitNumber
  END
WHERE unitNumber LIKE '%-%';
```

ุฃู ูู C# (Backend):
```csharp
// ุณูุฑูุจุช ุชุฑุญูู
var units = await _context.Units.ToListAsync();
foreach (var unit in units)
{
    // ุฅุฐุง ูุงู unitNumber ูุญุชูู ุนูู "-"
    if (unit.UnitNumber.Contains("-"))
    {
        // ุงุณุชุฎุฑุงุฌ ุงูุฌุฒุก ุงูุฃุฎูุฑ ููุท
        var parts = unit.UnitNumber.Split('-');
        unit.UnitNumber = parts[^1]; // ุขุฎุฑ ุฌุฒุก
    }
}
await _context.SaveChangesAsync();
```

## ๐ ููุงุญุธุงุช ูููุฉ

### 1. ูููุญุฏุงุช ุงููุฏููุฉ (Service/Mixed/Ground):
- ูุชู ุชุฎุฒูู `unitNumber` ููุง ุฃุฏุฎูู ุงููุณุชุฎุฏู ุจุงูุถุจุท
- ูููู ุฃู ูููู ุฑูู ุจุณูุท: "01"
- ุฃู ููุฏ ูุฎุตุต: "STORE-01", "CLINIC-A", "REST-001"
- ุงููุฑููุฉ ุงููุงููุฉ ูุชุงุญุฉ ูููุณุชุฎุฏู

### 2. ูููุญุฏุงุช ุงูุชููุงุฆูุฉ:
- ูุชู ุชุฎุฒูู ุงูุฑูู ุงููุชุณูุณู ููุท
- ุฏุงุฆูุงู ุจุตูุบุฉ ุฑูููุฉ ุจู padding: "01", "02", "10", "99"
- ุจุฏุงูุฉ ุงูุชุฑููู ูู `startNumber` ุงููุญุฏุฏ

### 3. ูู ุงููุฑููุช ุฅูุฏ:
- ูููู ุจูุงุก ุงูููุฏ ุงููุงูู ุนูุฏ ุงูุญุงุฌุฉ
- ุงุณุชุฎุฏู ุฏุงูุฉ ูุณุงุนุฏุฉ ูุฏูุฌ ุงููุนูููุงุช
- ุชุฎุตูุต ุตูุบุฉ ุงูุนุฑุถ ุญุณุจ ุงูุณูุงู ูุงููุงุฌูุฉ

### 4. ูู Backend API:
- ุนูุฏ ุฅุฑุฌุงุน ุงููุญุฏุงุชุ ูุฏ ุชุญุชุงุฌ ูุฅุถุงูุฉ ุฎุงุตูุฉ ูุญุณูุจุฉ `fullCode`
- ุฃู ุฅุฑุฌุงุน ูุนูููุงุช ุงูุทุงุจู ูุงูุจุฑุฌ ูููุตูุฉ
- ุงููุฑููุช ุฅูุฏ ูููู ุจุงูุฏูุฌ ุญุณุจ ุงูุญุงุฌุฉ

## ๐ ุงููููุงุช ุงููุชุฃุซุฑุฉ

### src/components/building-builder/Step3FloorDefinitions.tsx
**ุงูุชุนุฏููุงุช**:
1. **ุงูุณุทุฑ ~405**: ุชุญุฏูุซ ุญูุธ ุงููุญุฏุงุช ุงูุชููุงุฆูุฉ
   - ุฅุฒุงูุฉ ุงููุชุบูุฑ `isRes`
   - ุฅุฒุงูุฉ ุงุณุชุฏุนุงุก `buildUnitCode`
   - ุชุฎุฒูู `unitNumber` ูุฑูู ููุท ูุฌููุน ุงูุฃููุงุน

2. **ุงูุณุทุฑ ~340**: ุญุฐู ุฏุงูุฉ `buildUnitCode`
   - ูู ุชุนุฏ ูุณุชุฎุฏูุฉ ูู ุนูููุฉ ุงูุญูุธ
   - ูููู ุฅูุดุงุก ูุณุฎุฉ ูููุง ูู ุตูุญุงุช ุงูุนุฑุถ ุฅุฐุง ูุฒู ุงูุฃูุฑ

## โ ุงูุงุฎุชุจุงุฑ

### ุงุฎุชุจุงุฑุงุช ูุงุฌุญุฉ:
- [x] ุงูุจูุงุก: `npm run build` (21.47s) โ
- [x] ูุง ุฃุฎุทุงุก TypeScript โ
- [x] ุฌููุน ุฃููุงุน ุงููุญุฏุงุช ุชูุฎุฒู ุจุฑูู ููุท โ
- [x] ุงููุญุฏุงุช ุงููุฏููุฉ ุชุญุชูุธ ุจุฃููุงุฏูุง ุงููุฎุตุตุฉ โ

### ุงูุณููุงุฑูููุงุช ุงููุฏุนููุฉ:
- [x] ูุญุฏุงุช ุณูููุฉ: "01", "02", "03" โ
- [x] ูุญุฏุงุช ููุชุจูุฉ: "10", "11", "12" โ
- [x] ููุงูู ุณูุงุฑุงุช: "01", "02", "03" โ
- [x] ูุญุฏุงุช ุฎุฏููุฉ ูุฏููุฉ: "STORE-01", "CLINIC-A" โ
- [x] ูุญุฏุงุช ูุฎุชูุทุฉ ูุฏููุฉ: "501", "OFF-502" โ

## ๐ฏ ุงูุฎุทูุงุช ุงูุชุงููุฉ (ูููุฑููุช ุฅูุฏ)

### 1. ุฅูุดุงุก ุฏุงูุฉ ูุณุงุนุฏุฉ ููุนุฑุถ
```typescript
// ูู ููู utils ุฃู hooks
export function formatUnitFullCode(
  unitNumber: string,
  floorCode: string,
  blockName?: string,
  towerName?: string,
  options?: DisplayOptions
): string {
  // ... ููุทู ุงูุฏูุฌ
}
```

### 2. ุงุณุชุฎุฏุงููุง ูู ุตูุญุงุช ุงูุนุฑุถ
```typescript
// ูู ูููู ุนุฑุถ ุงููุญุฏุงุช
const fullCode = formatUnitFullCode(
  unit.unitNumber,
  floor.floorCode,
  block.name,
  tower.name,
  { includeAll: true }
)
```

### 3. ูู ุงูุฌุฏุงูู ูุงูููุงุฆู
```typescript
// ุนุฑุถ ุจุณูุท
<td>{unit.unitNumber}</td>

// ุนุฑุถ ูุงูู
<td>{formatUnitFullCode(unit, floor, block, tower)}</td>
```

## ๐ ุงููุชูุฌุฉ ุงูููุงุฆูุฉ

ูุธุงู ุชุฎุฒูู ููุญุฏ ูููุทูู:
- โ **unitNumber** ูุญุชูู ุนูู ุฑูู ุงููุญุฏุฉ ููุท
- โ ูุนูููุงุช ุงูุจุฑุฌ ูุงูุทุงุจู ูู ุญููููุง ุงูุฎุงุตุฉ
- โ ูุฑููุฉ ูุงููุฉ ูู ุทุฑููุฉ ุงูุนุฑุถ
- โ ุณูููุฉ ุงูุตูุงูุฉ ูุงูุชุญุฏูุซ
- โ ุงุณุชุนูุงูุงุช ุฃุณุฑุน ูุฃูุซุฑ ููุงุกุฉ
- โ ุงุชุณุงู ูุงูู ุนุจุฑ ุฌููุน ุฃููุงุน ุงููุญุฏุงุช
